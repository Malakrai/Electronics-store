<div class="container">

  <h2>Gestion des Utilisateurs</h2>

  <div *ngIf="successMessage" class="alert alert-success">{{ successMessage }}</div>
  <div *ngIf="errorMessage" class="alert alert-danger">{{ errorMessage }}</div>

  <div class="card">
    <h3>{{ isEditing ? 'Modifier utilisateur' : 'Ajouter utilisateur' }}</h3>

    <form (ngSubmit)="onSubmit()">
      <div class="form-grid">
        <input placeholder="PrÃ©nom *" [(ngModel)]="formData.firstName" name="firstName">
        <input placeholder="Nom *" [(ngModel)]="formData.lastName" name="lastName">
        <input placeholder="Email *" [(ngModel)]="formData.email" name="email">

        <input
          type="password"
          placeholder="{{ isEditing ? 'Mot de passe (optionnel)' : 'Mot de passe *' }}"
          [(ngModel)]="formData.password"
          name="password"
        >

        <input placeholder="TÃ©lÃ©phone" [(ngModel)]="formData.phone" name="phone">
        <textarea placeholder="Adresse" [(ngModel)]="formData.address" name="address"></textarea>
      </div>

      <div class="actions">
        <button class="btn btn-primary" [disabled]="loading">
          {{ isEditing ? 'Mettre Ã  jour' : 'CrÃ©er' }}
        </button>
        <button *ngIf="isEditing" type="button" class="btn" (click)="cancelEdit()">
          Annuler
        </button>
      </div>
    </form>
  </div>

  <div class="card">
    <table class="users-table">
      <thead>
      <tr>
        <th>ID</th>
        <th>Nom</th>
        <th>Email</th>
        <th>RÃ´les</th>
        <th>Actions</th>
      </tr>
      </thead>

      <tbody>
      <tr *ngFor="let user of users">
        <td>{{ user.id }}</td>
        <td>{{ user.firstName }} {{ user.lastName }}</td>
        <td>{{ user.email }}</td>

        <!-- âœ… CORRECTION ICI -->
        <td>
          <ng-container *ngIf="user.roles as roles; else noRole">
            <span class="role-badge">{{ roles.join(', ') }}</span>
          </ng-container>

          <ng-template #noRole>-</ng-template>
        </td>

        <td>
          <button class="btn btn-sm" (click)="editUser(user)">âœï¸</button>
          <button
            class="btn btn-sm btn-danger"
            (click)="deleteUser(user)"
            [disabled]="loadingUserId === user.id"
          >
            ğŸ—‘ï¸
          </button>
        </td>
      </tr>
      </tbody>
    </table>
  </div>

</div>
