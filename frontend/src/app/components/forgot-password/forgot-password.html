<div class="container">
  <div class="row justify-content-center">
    <div class="col-md-6 col-lg-5 col-xl-4">
      <div class="card border-0 shadow-lg rounded-4 overflow-hidden">

        <div class="card-body p-4 p-md-5">

          <!-- Étape 1: Demande d'email -->
          <div *ngIf="step === 1" class="animate-fade-in">
            <!-- Description -->
            <div class="text-center mb-4">
              <i class="fas fa-envelope fa-2x text-primary mb-3"></i>
              <h4 class="fw-semibold mb-2">Réinitialisation du mot de passe</h4>
              <p class="text-muted small">Entrez votre email pour recevoir le lien de réinitialisation</p>
            </div>

            <!-- Formulaire email -->
            <div class="mb-4">
              <label class="form-label fw-semibold mb-2 small">
                <i class="fas fa-at me-2 text-primary"></i>
                Adresse Email
              </label>
              <div class="input-group">
                <span class="input-group-text bg-light py-2">
                  <i class="fas fa-envelope text-muted"></i>
                </span>
                <input type="email"
                       class="form-control py-2"
                       [(ngModel)]="email"
                       placeholder="votre@email.com">
              </div>
            </div>

            <!-- Bouton d'envoi -->
            <div class="d-grid gap-2">
              <button class="btn btn-primary py-2 fw-semibold"
                      (click)="requestReset()"
                      [disabled]="isLoading || !email">
                <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-2"></span>
                <i *ngIf="!isLoading" class="fas fa-paper-plane me-2"></i>
                {{ isLoading ? 'Envoi en cours...' : 'Envoyer le lien' }}
              </button>
            </div>

            <!-- Message informatif -->
            <div class="alert alert-info mt-4 border-0 shadow-sm p-3">
              <div class="d-flex align-items-start">
                <i class="fas fa-info-circle mt-1 me-3 text-info"></i>
                <div>
                  <strong class="d-block mb-1 small">Comment ça marche ?</strong>
                  <small class="text-muted small">
                    • Entrez votre email associé au compte<br>
                    • Recevez un lien de réinitialisation<br>
                    • Définissez votre nouveau mot de passe
                  </small>
                </div>
              </div>
            </div>
          </div>

          <!-- Étape 2: Nouveau mot de passe -->
          <div *ngIf="step === 2" class="animate-fade-in">
            <!-- Description -->
            <div class="text-center mb-4">
              <i class="fas fa-key fa-2x text-primary mb-3"></i>
              <h4 class="fw-semibold mb-2">Nouveau mot de passe</h4>
              <p class="text-muted small">Choisissez un mot de passe sécurisé</p>
            </div>

            <!-- Formulaire -->
            <div class="mb-3">
              <label class="form-label fw-semibold mb-2 small">
                <i class="fas fa-lock me-2 text-primary"></i>
                Nouveau mot de passe
              </label>
              <div class="input-group">
                <span class="input-group-text bg-light py-2">
                  <i class="fas fa-key text-muted"></i>
                </span>
                <input [type]="newPasswordType"
                       class="form-control py-2"
                       [(ngModel)]="newPassword"
                       placeholder="Entrez votre mot de passe">
                <button class="btn btn-outline-secondary py-2"
                        type="button"
                        (click)="togglePasswordVisibility('newPassword')">
                  <i class="fas {{ getVisibilityIcon('newPassword') }}"></i>
                </button>
              </div>
              <!-- Indicateur de force du mot de passe -->
              <div class="mt-2">
                <div class="progress" style="height: 3px;">
                  <div class="progress-bar"
                       [class.bg-danger]="newPassword && newPassword.length < 6"
                       [class.bg-warning]="newPassword && newPassword.length >= 6 && newPassword.length < 8"
                       [class.bg-success]="newPassword && newPassword.length >= 8"
                       [style.width.%]="!newPassword ? 0 : newPassword.length >= 8 ? 100 : newPassword.length >= 6 ? 66 : 33">
                  </div>
                </div>
                <small class="text-muted mt-1 d-block small">
                  <i class="fas fa-info-circle me-1"></i>
                  Sécurité:
                  <span [class.text-danger]="newPassword && newPassword.length < 6"
                        [class.text-warning]="newPassword && newPassword.length >= 6 && newPassword.length < 8"
                        [class.text-success]="newPassword && newPassword.length >= 8">
                    {{ !newPassword ? 'Aucun' : newPassword.length < 6 ? 'Faible' : newPassword.length < 8 ? 'Moyen' : 'Fort' }}
                  </span>
                </small>
              </div>
            </div>

            <div class="mb-4">
              <label class="form-label fw-semibold mb-2 small">
                <i class="fas fa-check-circle me-2 text-primary"></i>
                Confirmer le mot de passe
              </label>
              <div class="input-group">
                <span class="input-group-text bg-light py-2">
                  <i class="fas fa-key text-muted"></i>
                </span>
                <input [type]="confirmPasswordType"
                       class="form-control py-2"
                       [(ngModel)]="confirmPassword"
                       placeholder="Confirmez votre mot de passe">
                <button class="btn btn-outline-secondary py-2"
                        type="button"
                        (click)="togglePasswordVisibility('confirmPassword')">
                  <i class="fas {{ getVisibilityIcon('confirmPassword') }}"></i>
                </button>
              </div>
              <!-- Validation en temps réel -->
              <div class="mt-2">
                <small *ngIf="confirmPassword && newPassword === confirmPassword && newPassword.length >= 6"
                       class="text-success small">
                  <i class="fas fa-check-circle me-1"></i>Les mots de passe correspondent
                </small>
                <small *ngIf="confirmPassword && newPassword !== confirmPassword"
                       class="text-danger small">
                  <i class="fas fa-times-circle me-1"></i>Les mots de passe ne correspondent pas
                </small>
              </div>
            </div>

            <!-- Boutons d'action -->
            <div class="d-grid gap-2">
              <button class="btn btn-primary py-2 fw-semibold"
                      (click)="resetPassword()"
                      [disabled]="isLoading || !newPassword || !confirmPassword || newPassword !== confirmPassword || newPassword.length < 6">
                <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-2"></span>
                <i *ngIf="!isLoading" class="fas fa-save me-2"></i>
                {{ isLoading ? 'Traitement...' : 'Mettre à jour' }}
              </button>

              <button class="btn btn-outline-secondary py-2"
                      (click)="back()"
                      *ngIf="step === 2"
                      [disabled]="isLoading">
                <i class="fas fa-arrow-left me-2"></i>Retour
              </button>
            </div>

            <!-- Message d'exigence -->
            <div class="alert alert-info mt-4 border-0 shadow-sm p-3">
              <div class="d-flex align-items-start">
                <i class="fas fa-shield-alt mt-1 me-3 text-info"></i>
                <div>
                  <strong class="d-block mb-1 small">Recommandations de sécurité</strong>
                  <small class="text-muted small">
                    • Au moins 6 caractères<br>
                    • Lettres + chiffres<br>
                    • Évitez les mots courants
                  </small>
                </div>
              </div>
            </div>
          </div>

          <!-- Étape 3: Confirmation (si l'utilisateur vient du lien) -->
          <div *ngIf="step === 3" class="animate-fade-in">
            <!-- Description -->
            <div class="text-center mb-4">
              <i class="fas fa-key fa-2x text-primary mb-3"></i>
              <h4 class="fw-semibold mb-2">Nouveau mot de passe</h4>
              <p class="text-muted small">Choisissez un mot de passe sécurisé</p>
            </div>

            <!-- Formulaire -->
            <div class="mb-3">
              <label class="form-label fw-semibold mb-2 small">
                <i class="fas fa-lock me-2 text-primary"></i>
                Nouveau mot de passe
              </label>
              <div class="input-group">
                <span class="input-group-text bg-light py-2">
                  <i class="fas fa-key text-muted"></i>
                </span>
                <input [type]="newPasswordType"
                       class="form-control py-2"
                       [(ngModel)]="newPassword"
                       placeholder="Entrez votre mot de passe">
                <button class="btn btn-outline-secondary py-2"
                        type="button"
                        (click)="togglePasswordVisibility('newPassword')">
                  <i class="fas {{ getVisibilityIcon('newPassword') }}"></i>
                </button>
              </div>
              <!-- Indicateur de force du mot de passe -->
              <div class="mt-2">
                <div class="progress" style="height: 3px;">
                  <div class="progress-bar"
                       [class.bg-danger]="newPassword && newPassword.length < 6"
                       [class.bg-warning]="newPassword && newPassword.length >= 6 && newPassword.length < 8"
                       [class.bg-success]="newPassword && newPassword.length >= 8"
                       [style.width.%]="!newPassword ? 0 : newPassword.length >= 8 ? 100 : newPassword.length >= 6 ? 66 : 33">
                  </div>
                </div>
                <small class="text-muted mt-1 d-block small">
                  <i class="fas fa-info-circle me-1"></i>
                  Sécurité:
                  <span [class.text-danger]="newPassword && newPassword.length < 6"
                        [class.text-warning]="newPassword && newPassword.length >= 6 && newPassword.length < 8"
                        [class.text-success]="newPassword && newPassword.length >= 8">
                    {{ !newPassword ? 'Aucun' : newPassword.length < 6 ? 'Faible' : newPassword.length < 8 ? 'Moyen' : 'Fort' }}
                  </span>
                </small>
              </div>
            </div>

            <div class="mb-4">
              <label class="form-label fw-semibold mb-2 small">
                <i class="fas fa-check-circle me-2 text-primary"></i>
                Confirmer le mot de passe
              </label>
              <div class="input-group">
                <span class="input-group-text bg-light py-2">
                  <i class="fas fa-key text-muted"></i>
                </span>
                <input [type]="confirmPasswordType"
                       class="form-control py-2"
                       [(ngModel)]="confirmPassword"
                       placeholder="Confirmez votre mot de passe">
                <button class="btn btn-outline-secondary py-2"
                        type="button"
                        (click)="togglePasswordVisibility('confirmPassword')">
                  <i class="fas {{ getVisibilityIcon('confirmPassword') }}"></i>
                </button>
              </div>
              <!-- Validation en temps réel -->
              <div class="mt-2">
                <small *ngIf="confirmPassword && newPassword === confirmPassword && newPassword.length >= 6"
                       class="text-success small">
                  <i class="fas fa-check-circle me-1"></i>Les mots de passe correspondent
                </small>
                <small *ngIf="confirmPassword && newPassword !== confirmPassword"
                       class="text-danger small">
                  <i class="fas fa-times-circle me-1"></i>Les mots de passe ne correspondent pas
                </small>
              </div>
            </div>

            <!-- Boutons d'action -->
            <div class="d-grid gap-2">
              <button class="btn btn-primary py-2 fw-semibold"
                      (click)="resetPassword()"
                      [disabled]="isLoading || !newPassword || !confirmPassword || newPassword !== confirmPassword || newPassword.length < 6">
                <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-2"></span>
                <i *ngIf="!isLoading" class="fas fa-save me-2"></i>
                {{ isLoading ? 'Traitement...' : 'Mettre à jour' }}
              </button>
            </div>

            <!-- Message d'exigence -->
            <div class="alert alert-info mt-4 border-0 shadow-sm p-3">
              <div class="d-flex align-items-start">
                <i class="fas fa-shield-alt mt-1 me-3 text-info"></i>
                <div>
                  <strong class="d-block mb-1 small">Recommandations de sécurité</strong>
                  <small class="text-muted small">
                    • Au moins 6 caractères<br>
                    • Lettres + chiffres<br>
                    • Évitez les mots courants
                  </small>
                </div>
              </div>
            </div>
          </div>

          <!-- Messages d'état (commun à toutes les étapes) -->
          <div *ngIf="successMessage" class="alert alert-success alert-dismissible fade show mt-3 border-0 shadow-sm p-3">
            <div class="d-flex align-items-center">
              <i class="fas fa-check-circle me-3"></i>
              <div class="flex-grow-1 small">{{ successMessage }}</div>
              <button type="button" class="btn-close" (click)="successMessage = ''"></button>
            </div>
          </div>

          <div *ngIf="errorMessage" class="alert alert-danger alert-dismissible fade show mt-3 border-0 shadow-sm p-3">
            <div class="d-flex align-items-center">
              <i class="fas fa-exclamation-triangle me-3"></i>
              <div class="flex-grow-1 small">{{ errorMessage }}</div>
              <button type="button" class="btn-close" (click)="errorMessage = ''"></button>
            </div>
          </div>

          <!-- Lien retour -->
          <div class="text-center mt-4 pt-3 border-top">
            <a routerLink="/login" class="text-decoration-none text-primary small">
              <i class="fas fa-arrow-left me-2"></i>Retour à la connexion
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
