<div class="register-container">
  <div class="register-card">
    <h2>
      <i class="fas fa-user-plus"></i> Créer un compte client
    </h2>

    <form [formGroup]="registerForm" (ngSubmit)="onSubmit()">
      <!-- Prénom et Nom -->
      <div class="row">
        <div class="col-md-6">
          <div class="form-group">
            <label for="firstName">
              <i class="fas fa-user"></i> Prénom
            </label>
            <input
              type="text"
              id="firstName"
              formControlName="firstName"
              class="form-control"
              placeholder="Votre prénom"
              [class.is-invalid]="registerForm.get('firstName')?.invalid && registerForm.get('firstName')?.touched"
            >
            <div class="invalid-feedback" *ngIf="registerForm.get('firstName')?.invalid && registerForm.get('firstName')?.touched">
              <i class="fas fa-exclamation-circle"></i> Prénom requis
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="form-group">
            <label for="lastName">
              <i class="fas fa-user"></i> Nom
            </label>
            <input
              type="text"
              id="lastName"
              formControlName="lastName"
              class="form-control"
              placeholder="Votre nom"
              [class.is-invalid]="registerForm.get('lastName')?.invalid && registerForm.get('lastName')?.touched"
            >
            <div class="invalid-feedback" *ngIf="registerForm.get('lastName')?.invalid && registerForm.get('lastName')?.touched">
              <i class="fas fa-exclamation-circle"></i> Nom requis
            </div>
          </div>
        </div>
      </div>

      <!-- Email -->
      <div class="form-group">
        <label for="email">
          <i class="fas fa-envelope"></i> Email
        </label>
        <input
          type="email"
          id="email"
          formControlName="email"
          class="form-control"
          placeholder="votre@email.com"
          [class.is-invalid]="registerForm.get('email')?.invalid && registerForm.get('email')?.touched"
          (input)="onEmailChange()"
        >
        <div class="invalid-feedback" *ngIf="registerForm.get('email')?.invalid && registerForm.get('email')?.touched">
          <div *ngIf="registerForm.get('email')?.errors?.['required']">
            <i class="fas fa-exclamation-circle"></i> Email requis
          </div>
          <div *ngIf="registerForm.get('email')?.errors?.['email']">
            <i class="fas fa-exclamation-circle"></i> Format d'email invalide
          </div>
        </div>
      </div>

      <!-- Mot de passe -->
      <div class="form-group">
        <label for="password">
          <i class="fas fa-lock"></i> Mot de passe
        </label>
        <input
          type="password"
          id="password"
          formControlName="password"
          class="form-control"
          placeholder="Minimum 6 caractères"
          [class.is-invalid]="registerForm.get('password')?.invalid && registerForm.get('password')?.touched"
        >
        <div class="invalid-feedback" *ngIf="registerForm.get('password')?.invalid && registerForm.get('password')?.touched">
          <div *ngIf="registerForm.get('password')?.errors?.['required']">
            <i class="fas fa-exclamation-circle"></i> Mot de passe requis
          </div>
          <div *ngIf="registerForm.get('password')?.errors?.['minlength']">
            <i class="fas fa-exclamation-circle"></i> Minimum 6 caractères requis
          </div>
        </div>
      </div>

      <!-- Confirmation mot de passe -->
      <div class="form-group">
        <label for="confirmPassword">
          <i class="fas fa-check-circle"></i> Confirmer le mot de passe
        </label>
        <input
          type="password"
          id="confirmPassword"
          formControlName="confirmPassword"
          class="form-control"
          placeholder="Confirmez votre mot de passe"
          [class.is-invalid]="registerForm.get('confirmPassword')?.invalid && registerForm.get('confirmPassword')?.touched"
        >
        <div class="invalid-feedback" *ngIf="registerForm.get('confirmPassword')?.errors?.['passwordMismatch']">
          <i class="fas fa-exclamation-circle"></i> Les mots de passe ne correspondent pas
        </div>
        <div class="invalid-feedback" *ngIf="registerForm.get('confirmPassword')?.errors?.['required']">
          <i class="fas fa-exclamation-circle"></i> Confirmation du mot de passe requise
        </div>
      </div>

      <!-- Messages -->
      <div *ngIf="successMessage" class="alert alert-success">
        <i class="fas fa-check-circle"></i> {{ successMessage }}
      </div>

      <!-- Alerte pour email déjà existant -->
      <div *ngIf="emailExistsError" class="alert alert-danger">
        <i class="fas fa-exclamation-triangle"></i> Cet email est déjà utilisé.
        <a routerLink="/login" class="alert-link">Connectez-vous</a> ou
        <a routerLink="/forgot-password" class="alert-link">récupérez votre mot de passe</a>.
      </div>

      <!-- Alerte pour autres erreurs -->
      <div *ngIf="errorMessage && !emailExistsError" class="alert alert-danger">
        <i class="fas fa-exclamation-triangle"></i> {{ errorMessage }}
      </div>

      <!-- Bouton d'inscription -->
      <div class="button-group">
        <button
          type="submit"
          class="btn btn-primary btn-block w-100 mb-2"
          [disabled]="isLoading || !registerForm.valid"
        >
          <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-2"></span>
          <i class="fas fa-user-plus me-2" *ngIf="!isLoading"></i>
          {{ isLoading ? 'Inscription en cours...' : 'S\'inscrire' }}
        </button>
      </div>

      <!-- Lien vers login -->
      <div class="text-center mt-3">
        <p>Déjà un compte ?
          <a routerLink="/login" class="text-decoration-none fw-bold">
            <i class="fas fa-sign-in-alt"></i> Se connecter
          </a>
        </p>
      </div>
    </form>
  </div>
</div>
