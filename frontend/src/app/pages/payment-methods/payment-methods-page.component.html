<section class="card">
  <div class="card-header">
    <div>
      <h1>Moyens de paiement</h1>
      <p class="subtitle">G√©rez vos m√©thodes de paiement pour des achats plus rapides.</p>
    </div>
    <button class="btn primary" (click)="showAddForm = true" *ngIf="!showAddForm">
      ‚ûï Ajouter un moyen de paiement
    </button>
  </div>

  <div *ngIf="loading" class="loading">
    <div class="spinner"></div>
    <p>Chargement de vos moyens de paiement...</p>
  </div>

  <div *ngIf="error" class="error-message">
    ‚ö†Ô∏è {{ error }}
  </div>

  <div *ngIf="!loading">
    <!-- Liste des m√©thodes de paiement existantes -->
    <div class="payment-methods-list">
      <div *ngFor="let method of paymentMethods" class="payment-method-card">
        <div class="payment-method-header">
          <div class="payment-method-icon">
            {{ getBrandIcon(method.brand) }}
          </div>
          <div class="payment-method-info">
            <div class="payment-method-type">
              <strong>{{ getTypeLabel(method.type) }}</strong>
              <span *ngIf="method.isDefault" class="default-badge">Par d√©faut</span>
            </div>
            <div class="payment-method-details">
              <span *ngIf="method.type === 'CARD'">
                {{ method.brand }} ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ {{ method.last4 }}
              </span>
              <span *ngIf="method.type === 'CARD'">
                Expire le {{ getExpirationDate(method.expMonth, method.expYear) }}
              </span>
              <span *ngIf="method.type === 'PAYPAL'">
                Compte PayPal
              </span>
              <span *ngIf="method.type === 'BANK_TRANSFER'">
                Virement bancaire
              </span>
            </div>
            <div class="payment-method-date">
              Ajout√© le {{ getFormattedDate(method.createdAt) }}
            </div>
          </div>
        </div>

        <div class="payment-method-actions">
          <button class="btn outline"
                  (click)="setDefaultMethod(method.id)"
                  [disabled]="method.isDefault">
            D√©finir par d√©faut
          </button>
          <button class="btn danger outline"
                  (click)="removeMethod(method.id)">
            Supprimer
          </button>
        </div>
      </div>

      <div *ngIf="paymentMethods.length === 0" class="empty-state">
        <div class="empty-icon">üí≥</div>
        <h3>Aucun moyen de paiement enregistr√©</h3>
        <p>Ajoutez votre premi√®re m√©thode de paiement pour des achats plus rapides.</p>
        <button class="btn primary" (click)="showAddForm = true">
          Ajouter un moyen de paiement
        </button>
      </div>
    </div>

    <!-- Formulaire d'ajout -->
    <div *ngIf="showAddForm" class="add-payment-form">
      <div class="form-header">
        <h3>Ajouter un moyen de paiement</h3>
        <button class="btn close" (click)="showAddForm = false; resetForm()">√ó</button>
      </div>

      <div class="form-body">
        <div class="form-group">
          <label>Type de paiement *</label>
          <select class="form-select" [(ngModel)]="newMethod.type">
            <option value="CARD">Carte bancaire</option>
            <option value="PAYPAL">PayPal</option>
            <option value="BANK_TRANSFER">Virement bancaire</option>
          </select>
        </div>

        <!-- Champs sp√©cifiques pour carte bancaire -->
        <div *ngIf="newMethod.type === 'CARD'">
          <div class="form-group">
            <label>Marque de la carte *</label>
            <select class="form-select" [(ngModel)]="newMethod.brand">
              <option value="VISA">Visa</option>
              <option value="MASTERCARD">MasterCard</option>
              <option value="AMEX">American Express</option>
              <option value="DISCOVER">Discover</option>
            </select>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>4 derniers chiffres *</label>
              <input class="form-input"
                     type="text"
                     [(ngModel)]="newMethod.last4"
                     placeholder="4242"
                     maxlength="4"
                     pattern="[0-9]{4}">
              <small class="form-hint">Les 4 derniers chiffres de votre carte</small>
            </div>

            <div class="form-group">
              <label>Mois d'expiration *</label>
              <select class="form-select" [(ngModel)]="newMethod.expMonth">
                <option *ngFor="let month of [1,2,3,4,5,6,7,8,9,10,11,12]" [value]="month">
                  {{ month.toString().padStart(2, '0') }}
                </option>
              </select>
            </div>

            <div class="form-group">
              <label>Ann√©e d'expiration *</label>
              <select class="form-select" [(ngModel)]="newMethod.expYear">
                <option *ngFor="let year of getFutureYears(10)" [value]="year">
                  {{ year }}
                </option>
              </select>
            </div>
          </div>
        </div>

        <!-- Champs sp√©cifiques pour PayPal -->
        <div *ngIf="newMethod.type === 'PAYPAL'" class="paypal-info">
          <div class="info-icon">üîµ</div>
          <div class="info-text">
            <p><strong>Connexion PayPal</strong></p>
            <p>Vous serez redirig√© vers PayPal pour vous connecter et autoriser les paiements.</p>
          </div>
        </div>

        <!-- Champs sp√©cifiques pour virement bancaire -->
        <div *ngIf="newMethod.type === 'BANK_TRANSFER'" class="bank-transfer-info">
          <div class="info-icon">üè¶</div>
          <div class="info-text">
            <p><strong>Virement bancaire</strong></p>
            <p>Les d√©tails de virement vous seront communiqu√©s lors de la commande.</p>
          </div>
        </div>

        <div class="form-group checkbox-group">
          <label class="checkbox">
            <input type="checkbox" [(ngModel)]="newMethod.isDefault">
            <span>D√©finir comme m√©thode de paiement par d√©faut</span>
          </label>
          <small class="form-hint">Cette m√©thode sera utilis√©e automatiquement pour vos paiements</small>
        </div>

        <div *ngIf="error" class="error-message">
          ‚ö†Ô∏è {{ error }}
        </div>

        <div class="form-actions">
          <button class="btn outline" (click)="showAddForm = false; resetForm()">
            Annuler
          </button>
          <button class="btn primary" (click)="addPaymentMethod()">
            Ajouter le moyen de paiement
          </button>
        </div>

        <div class="security-note">
          üîí <strong>S√©curit√© garantie</strong>
          <p>Vos donn√©es de paiement sont crypt√©es et s√©curis√©es. Nous ne stockons jamais le num√©ro complet de votre carte ni votre code de s√©curit√© (CVV).</p>
        </div>
      </div>
    </div>
  </div>
</section>
